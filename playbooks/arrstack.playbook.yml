---
- name: Configure arrstack
  hosts: localhost
  tasks:
    - name: Configure prowlarr
      tags:
        - prowlarr
      block:
        - name: Add sonarr
          devopsarr.prowlarr.prowlarr_application:
            name: Sonarr
            sync_level: fullSync
            config_contract: SonarrSettings
            implementation: Sonarr
            fields:
              - name: prowlarrUrl
                value: "{{ ansible_env.PROWLARR_URL }}"
              - name: baseUrl
                value: "{{ ansible_env.SONARR_URL }}"
              - name: apiKey
                value: "{{ ansible_env.SONARR_API_KEY }}"
              - name: syncCategories
                value:
                  - 5000
                  - 5010
              - name: syncRejectBlocklistedTorrentHashesWhileGrabbing
                value: false
        - name: Add radarr
          devopsarr.prowlarr.prowlarr_application:
            name: Radarr
            sync_level: fullSync
            config_contract: RadarrSettings
            implementation: Radarr
            fields:
              - name: prowlarrUrl
                value: "{{ ansible_env.PROWLARR_URL }}"
              - name: baseUrl
                value: "{{ ansible_env.RADARR_URL }}"
              - name: apiKey
                value: "{{ ansible_env.RADARR_API_KEY }}"
              - name: syncCategories
                value:
                  - 2000
              - name: syncRejectBlocklistedTorrentHashesWhileGrabbing
                value: false
    - name: Configure sonarr
      tags:
        - sonarr
      block:
        - name: Create a root folder
          devopsarr.sonarr.sonarr_root_folder:
            path: '/tv'
            state: present
        - name: Update media management
          devopsarr.sonarr.sonarr_media_management:
            chmod_folder: "755"
            rescan_after_refresh: "always"
            recycle_bin: ""
            file_date: "localAirDate"
            episode_title_required: "always"
            download_propers_and_repacks: "preferAndUpgrade"
            minimum_free_space_when_importing: 100
            recycle_bin_cleanup_days: 7
            auto_unmonitor_previously_downloaded_episodes: true
            skip_free_space_check_when_importing: true
            set_permissions_linux: true
            import_extra_files: true
            enable_media_info: true
            delete_empty_folders: true
            create_empty_series_folders: true
            copy_using_hardlinks: true
        - name: Update naming
          devopsarr.sonarr.sonarr_naming:
            rename_episodes: true
            replace_illegal_characters: true
            multi_episode_style: 5
            colon_replacement_format: 1
            daily_episode_format: '{Series TitleYear} - {Air-Date} - {Episode CleanTitle:90} {[Custom Formats]}{[Quality Full]}{[Mediainfo AudioCodec}{ Mediainfo AudioChannels]}{[MediaInfo VideoDynamicRangeType]}{[Mediainfo VideoCodec]}{-Release Group}'
            anime_episode_format: '{Series TitleYear} - S{season:00}E{episode:00} - {absolute:000} - {Episode CleanTitle:90} {[Custom Formats]}{[Quality Full]}{[Mediainfo AudioCodec}{ Mediainfo AudioChannels]}{MediaInfo AudioLanguages}{[MediaInfo VideoDynamicRangeType]}[{Mediainfo VideoCodec }{MediaInfo VideoBitDepth}bit]{-Release Group}'
            series_folder_format: '{Series TitleYear} [tvdbid-{TvdbId}]'
            season_folder_format: 'Season {season:00}'
            specials_folder_format: 'S0'
            standard_episode_format: '{Series TitleYear} - S{season:00}E{episode:00} - {Episode CleanTitle:90} {[Custom Formats]}{[Quality Full]}{[Mediainfo AudioCodec}{ Mediainfo AudioChannels]}{[MediaInfo VideoDynamicRangeType]}{[Mediainfo VideoCodec]}{-Release Group}'

    - name: Configure radarr
      tags:
        - radarr
      block:
        - name: Create a root folder
          devopsarr.radarr.radarr_root_folder:
            path: '/film'
            state: present
        - name: Update media management
          devopsarr.radarr.radarr_media_management:
            chmod_folder: "755"
            rescan_after_refresh: "always"
            recycle_bin: ""
            file_date: "cinemas"
            download_propers_and_repacks: "preferAndUpgrade"
            minimum_free_space_when_importing: 100
            recycle_bin_cleanup_days: 7
            auto_unmonitor_previously_downloaded_movies: true
            skip_free_space_check_when_importing: true
            set_permissions_linux: true
            import_extra_files: true
            enable_media_info: true
            delete_empty_folders: true
            create_empty_movie_folders: true
            copy_using_hardlinks: true
            paths_default_static: false
            auto_rename_folders: true
        - name: Update naming
          devopsarr.radarr.radarr_naming:
            rename_movies: true
            replace_illegal_characters: true
            colon_replacement_format: 'dash'
            movie_folder_format: '{Movie CleanTitle} ({Release Year}) [tmdbid-{TmdbId}]'
            standard_movie_format: !unsafe '{Movie CleanTitle} {(Release Year)} [tmdbid-{TmdbId}] - {{Edition Tags}} {[MediaInfo 3D]}{[Custom Formats]}{[Quality Full]}{[Mediainfo AudioCodec}{ Mediainfo AudioChannels]}{[MediaInfo VideoDynamicRangeType]}{[Mediainfo VideoCodec]}{-Release Group}'
